{% extends 'social/base.html' %}
{% block content %}

<div class="container mt-4">

  <!-- üë§ Profile Header -->
  <div class="row align-items-center mb-4">
    <div class="col-md-4 text-center mb-3 mb-md-0">
      {% if profile.profile_picture %}
        <img src="{{ profile.profile_picture.url }}" class="rounded-circle shadow" width="150" height="150" alt="Profile picture">
      {% else %}
        <img src="https://via.placeholder.com/150" class="rounded-circle shadow" alt="No profile picture">
      {% endif %}
    </div>

    <div class="col-md-8 text-center text-md-start">
      <div class="d-flex align-items-center justify-content-center justify-content-md-start mb-3 flex-wrap gap-2">
        <h3 class="me-3 mb-0">{{ profile_user.username }}</h3>

        {% if request.user == profile_user %}
          <a href="{% url 'social:edit_profile' profile_user.username %}" class="btn btn-outline-secondary btn-sm">
            <i class="fa fa-pen me-1"></i> Edit Profile
          </a>
        {% else %}
          <form action="{% url 'social:toggle_follow' profile_user.username %}" method="post" class="d-inline">
            {% csrf_token %}
            {% if is_following %}
              <button class="btn btn-danger btn-sm" type="submit">
                <i class="fa fa-user-minus me-1"></i> Unfollow
              </button>
            {% else %}
              <button class="btn btn-primary btn-sm" type="submit">
                <i class="fa fa-user-plus me-1"></i> Follow
              </button>
            {% endif %}
          </form>
        {% endif %}
      </div>

      <div class="mb-2">
        <strong>{{ profile_user.followers_set.count }}</strong> followers ‚Ä¢
        <strong>{{ profile_user.following_set.count }}</strong> following
      </div>

      {% if profile.bio %}
        <p class="text-muted mb-0">{{ profile.bio }}</p>
      {% else %}
        {% if request.user == profile_user %}
          <p class="text-muted">Add a short bio in your profile.</p>
        {% endif %}
      {% endif %}
    </div>
  </div>

  <hr>

  <!-- üñºÔ∏è Posts Grid -->
  <h4 class="text-center mb-4">{{ profile_user.username }}'s Posts</h4>
  <div class="row g-3">
    {% for post in posts %}
      <div class="col-6 col-md-4">
        <a href="{% url 'social:post_detail' post.id %}">
          <div class="position-relative">
            {% if post.image %}
              <img src="{{ post.image.url }}" class="img-fluid rounded shadow-sm" alt="Post image">
            {% else %}
              <div class="border d-flex align-items-center justify-content-center rounded" style="height:200px;">
                <p class="text-muted px-2 text-center">{{ post.content|truncatewords:10 }}</p>
              </div>
            {% endif %}
            <div class="overlay position-absolute top-0 start-0 w-100 h-100 bg-dark bg-opacity-25 d-flex align-items-center justify-content-center opacity-0 hover-opacity transition">
              <span class="text-white fw-bold">
                ‚ù§Ô∏è {{ post.likes.count }} &nbsp; üí¨ {{ post.comments.count }}
              </span>
            </div>
          </div>
        </a>
      </div>
    {% empty %}
      <p class="text-center mt-4 text-muted">No posts yet.</p>
    {% endfor %}
  </div>
</div>

<!-- üåà Optional hover effect -->
<style>
  .hover-opacity:hover {
    opacity: 1 !important;
  }
  .transition {
    transition: opacity 0.3s ease;
  }
</style>

{% endblock %}
